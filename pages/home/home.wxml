<!--pages/home/home.wxml-->
<view class="container">

  <view wx:if="{{pets.length === 0}}" class="empty-state">
    <view class="empty-icon">ğŸ¾</view>
    <text class="empty-text">è¿˜æ²¡æœ‰æ·»åŠ å® ç‰©</text>
    <text class="empty-desc">è¯·åˆ°"é“²å±å®˜"é¡µé¢æ·»åŠ å® ç‰©ä¿¡æ¯</text>
  </view>

  <view wx:else class="pets-list">
    <view wx:for="{{pets}}" wx:key="id" class="pet-card">
      <view class="pet-layout">
        <!-- å·¦ä¾§å¤´åƒåŒºåŸŸ -->
        <view class="avatar-section">
          <text class="pet-name-on-avatar">{{item.name}}</text>
          <view class="pet-avatar">
            <image wx:if="{{item.avatar}}" src="{{item.avatar}}" class="avatar-img" mode="aspectFill"></image>
            <text wx:else class="avatar-placeholder">{{item.name.charAt(0)}}</text>
          </view>
        </view> <!-- avatar-section -->

        <!-- å³ä¾§è¿›é£Ÿä¿¡æ¯åŒºåŸŸ -->
        <view class="feeding-info">
          <!-- è¿›é£ŸçŠ¶æ€æ¦‚è§ˆ -->
          <view class="feeding-status">
            <text class="status-label">ä»Šæ—¥è¿›é£Ÿ</text>
            <view class="status-summary">
              <text class="feeding-count">{{feedingSummaries[item.id] ? feedingSummaries[item.id].count : 0}}æ¬¡</text>
              <text class="feeding-total">{{feedingSummaries[item.id] ? feedingSummaries[item.id].totalAmount : 0}}g</text>
            </view>
          </view>

          <!-- è¯¦ç»†è¿›é£Ÿè®°å½• -->
          <block wx:if="{{!feedingRecords[item.id] || feedingRecords[item.id].length == 0}}">
            <view class="no-feeding-today">
              <text class="no-feeding-text">ğŸ˜¿ ä»Šæ—¥è¿˜æœªè¿›é£Ÿ</text>
            </view>
          </block>

          <block wx:else>
            <view class="feeding-list">
              <view
                wx:for="{{feedingRecords[item.id]}}"
                wx:for-item="record"
                wx:for-index="index"
                wx:key="index"
                class="feeding-record"
              >
                <text class="feeding-time">{{record.time}}</text>
                <text class="feeding-order">ç¬¬{{index + 1}}æ¬¡</text>
                <text class="feeding-amount">{{record.amount}}g</text>
              </view>
            </view>
          </block>
        </view> <!-- feeding-info -->
        <button 
        class="manual-feed-btn"
        data-petid="{{item.id}}"
        bindtap="manualFeed"
      >
        æ‰‹åŠ¨æŠ•å–‚
      </button>
      </view> <!-- pet-layout -->
    </view> <!-- pet-card -->
  </view> <!-- pets-list -->

  <!-- é¥¥é¥¿å¼¹çª— -->
  <view wx:if="{{showHungryModal}}" class="hungry-modal-overlay" bindtap="closeHungryModal">
    <view class="hungry-modal" catchtap="">
      <view class="modal-content">
        <view class="modal-header">
          <text class="modal-icon">ğŸ˜¿</text>
          <text class="modal-title">{{hungryPet.name}}é¥¿äº†</text>
        </view>
        <view class="modal-body">
          <text class="modal-message">{{hungryPet.name}}ä»Šæ—¥å·²åˆ·å¡{{nfcScanCounts[hungryPet.id]}}æ¬¡ï¼Œå¯èƒ½æ˜¯é¥¿äº†éœ€è¦æŠ•å–‚ï¼Œæˆ–è€…éœ€è¦å‡è‚¥è®¡åˆ’ã€‚</text>
        </view>
        <view class="modal-buttons">
          <button class="modal-btn feed-btn" bindtap="feedNow">ç«‹å³æŠ•å–‚</button>
          <button class="modal-btn diet-btn" bindtap="helpDiet">å¸®TAå‡è‚¥</button>
        </view>
      </view>
    </view>
  </view>

</view>